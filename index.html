<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mock 3D (escala fija total, sin descargas)</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    :root{ --ml-yellow:#fff159; --ml-blue:#3483fa; --ml-text:#333; --ml-bg:#f5f5f5; }
    *{ box-sizing:border-box } body{ margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; color:var(--ml-text); background:var(--ml-bg); }
    header{ background:var(--ml-yellow); padding:14px 16px; position:sticky; top:0; z-index:10; display:flex; gap:12px; align-items:center;}
    header .logo{ width:124px; height:24px; background:#000; color:#fff; border-radius:4px; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:14px;}
    header input{ flex:1; border:none; border-radius:6px; padding:10px 12px; outline:none; }
    .container{ max-width:980px; margin:16px auto; padding:0 12px; }
    .product-card{ background:#fff; border-radius:12px; box-shadow:0 6px 24px rgba(0,0,0,.06); overflow:hidden;}
    .product-top{ display:grid; grid-template-columns:1fr; }
    .media,.details{ padding:16px; }
    .badges{display:flex; gap:8px; margin:8px 0 12px;}
    .badge{background:#eef3ff; color:#2b64d8; font-weight:600; font-size:12px; padding:6px 10px; border-radius:999px;}
    h1{font-size:20px; margin:6px 0 8px;} .price{font-size:24px; font-weight:700; margin:6px 0 12px;}
    .btns{display:flex; gap:10px; flex-wrap:wrap; margin:12px 0;}
    .btn{ padding:12px 14px; border:none; border-radius:10px; font-weight:700; cursor:pointer; }
    .btn-primary{ background:var(--ml-blue); color:#fff; } .btn-secondary{ background:#eef3ff; color:#2b64d8; }
    .hint{font-size:12px; color:#666; margin-top:6px;}
    #viewerWrap{ display:none; padding:12px; background:#fafafa; border-top:1px solid #eee; }
    model-viewer{ width:100%; background:#fff; border-radius:12px; --progress-bar-color: var(--ml-blue); }
    #heroMV{ height:54vh; pointer-events:none; border:1px solid #eee; }
    #mv{ height:60vh; touch-action:none; } /* evita pinch del navegador */
    .footer-actions{ display:flex; gap:10px; padding:12px; border-top:1px solid #eee; background:#fff; }
    .footer-actions .btn{ flex:1; }
    @media (min-width:880px){ #heroMV{ height:58vh; } #mv{ height:65vh; } .product-top{ grid-template-columns:1.1fr .9fr; gap:10px; } }
  </style>
</head>
<body>
<header>
  <div class="logo">ML Mock</div>
  <input placeholder="Buscar productos, marcas y más…" aria-label="Buscar" />
</header>

<main class="container">
  <section class="product-card">
    <div class="product-top">
      <div class="media">
        <div class="badges"><div class="badge">NUEVO</div><div class="badge">3D</div></div>

        <!-- “Foto” 2D: el mismo 3D embebido, sin controles -->
        <model-viewer id="heroMV"
          camera-controls="false" interaction-prompt="none" ar="false"
          environment-image="neutral" exposure="1.0" shadow-intensity="0.9"
          min-camera-orbit="auto auto 1.2m" max-camera-orbit="auto auto 1.2m"
          min-field-of-view="30deg" max-field-of-view="30deg" auto-rotate="false">
        </model-viewer>
        <p class="hint">Imagen generada del mismo 3D embebido (sin PNG/JPG).</p>
      </div>

      <div class="details">
        <h1>Objeto demo (volumen tipo zapatilla)</h1>
        <div class="price">$ 19.999</div>
        <p>Escala fija 1:1 • Para AR real luego alojamos el .glb/.usdz</p>
        <div class="btns">
          <button class="btn btn-primary">Comprar ahora</button>
          <button class="btn btn-secondary" id="toggle3d">👓 Ver en 3D</button>
        </div>
        <ul class="hint"><li>No se puede agrandar/achicar: tamaño bloqueado.</li></ul>
      </div>
    </div>

    <div id="viewerWrap">
      <!-- Visor 3D con escala fija total -->
      <model-viewer id="mv"
        camera-controls disable-zoom disable-pan
        min-camera-orbit="auto auto 1.2m" max-camera-orbit="auto auto 1.2m"
        min-field-of-view="30deg" max-field-of-view="30deg"
        environment-image="neutral" exposure="1.0" shadow-intensity="0.9" autoplay>
        <button slot="ar-button" class="btn btn-primary" disabled>Ver en tu espacio (AR)</button>
      </model-viewer>
      <p class="hint">AR nativo requiere alojar el 3D como archivo. Lo activamos cuando puedas subir un .glb/.usdz al repo.</p>
    </div>

    <div class="footer-actions">
      <button class="btn btn-secondary">Agregar al carrito</button>
      <button class="btn btn-primary">Comprar ahora</button>
    </div>
  </section>
</main>

<script>
/* Genera un glTF (26×10×8 cm) en memoria y lo sirve vía blob: URL. */
(function(){
  const L=0.26, W=0.10, H=0.08; const sx=L/2, sy=W/2, sz=H/2;
  const faces = [
    [[1,0,0],[ [sx,-sy,-sz],[sx,sy,-sz],[sx,sy,sz],[sx,-sy,sz] ]],
    [[-1,0,0],[ [-sx,-sy,sz],[-sx,sy,sz],[-sx,sy,-sz],[-sx,-sy,-sz] ]],
    [[0,1,0],[ [-sx,sy,-sz],[sx,sy,-sz],[sx,sy,sz],[-sx,sy,sz] ]],
    [[0,-1,0],[ [-sx,-sy,sz],[sx,-sy,sz],[sx,-sy,-sz],[-sx,-sy,-sz] ]],
    [[0,0,1],[ [-sx,-sy,sz],[sx,-sy,sz],[sx,sy,sz],[-sx,sy,sz] ]],
    [[0,0,-1],[ [-sx,sy,-sz],[sx,sy,-sz],[sx,-sy,-sz],[-sx,-sy,-sz] ]]
  ];
  const positions=[], normals=[], indices=[]; let base=0;
  for(const [n,corners] of faces){ for(const c of corners){positions.push(...c); normals.push(...n);} indices.push(base,base+1,base+2, base,base+2,base+3); base+=4; }
  function f32(a){const b=new ArrayBuffer(a.length*4); new Float32Array(b).set(a); return b;}
  function u16(a){const b=new ArrayBuffer(a.length*2); new Uint16Array(b).set(a); return b;}
  const pos=f32(positions), nor=f32(normals), idx=u16(indices);
  function concatAligned(arrs){let total=0,parts=[];for(const b of arrs){const pad=(4-(b.byteLength%4))%4;parts.push(b,new ArrayBuffer(pad));total+=b.byteLength+pad;}const out=new Uint8Array(total);let o=0;for(const p of parts){out.set(new Uint8Array(p),o);o+=p.byteLength;}return out.buffer;}
  const bin=concatAligned([pos,nor,idx]);
  const posOff=0, norOff=pos.byteLength+((4-(pos.byteLength%4))%4), idxOff=norOff+nor.byteLength+((4-(nor.byteLength%4))%4);
  const bufURL=URL.createObjectURL(new Blob([bin],{type:"application/octet-stream"}));
  const gltf={asset:{version:"2.0"},buffers:[{uri:bufURL,byteLength:bin.byteLength}],
    bufferViews:[{buffer:0,byteOffset:posOff,byteLength:pos.byteLength,target:34962},{buffer:0,byteOffset:norOff,byteLength:nor.byteLength,target:34962},{buffer:0,byteOffset:idxOff,byteLength:idx.byteLength,target:34963}],
    accessors:[{bufferView:0,byteOffset:0,componentType:5126,count:24,type:"VEC3",min:[-sx,-sy,-sz],max:[sx,sy,sz]},{bufferView:1,byteOffset:0,componentType:5126,count:24,type:"VEC3"},{bufferView:2,byteOffset:0,componentType:5123,count:36,type:"SCALAR"}],
    materials:[{pbrMetallicRoughness:{baseColorFactor:[0.2,0.2,0.22,1],metallicFactor:0.5,roughnessFactor:0.35}}],meshes:[{primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0}]}],nodes:[{mesh:0}],scenes:[{nodes:[0]}],scene:0};
  const gltfURL=URL.createObjectURL(new Blob([JSON.stringify(gltf)],{type:"model/gltf+json"}));

  // asignar a ambos visores
  document.getElementById('heroMV').src = gltfURL;
  const mv = document.getElementById('mv');
  mv.src = gltfURL;

  // === Candados adicionales de tamaño ===
  const FIX_RADIUS = '1.2m';
  const FIX_FOV = '30deg';

  // Aplica valores fijos
  function lockSize() {
    const o = mv.getCameraOrbit();
    mv.cameraOrbit = `${o.theta} ${o.phi} ${FIX_RADIUS}`;
    mv.fieldOfView = FIX_FOV;
  }

  // Bloquea cambios cada vez que el usuario intenta interactuar
  mv.addEventListener('camera-change', lockSize);
  mv.addEventListener('load', lockSize);

  // Cancela gestos que algunos navegadores usan para “quick zoom”
  ['wheel','dblclick','gesturestart','gesturechange','gestureend'].forEach(evt=>{
    mv.addEventListener(evt, e=>{ e.preventDefault(); lockSize(); }, {passive:false});
  });

  // Pinch de 2 dedos → cancelar y restaurar
  mv.addEventListener('touchmove', e=>{
    if(e.touches && e.touches.length>1){ e.preventDefault(); lockSize(); }
  }, {passive:false});

  // Bloqueo también en “tap to zoom” (si existiera)
  mv.addEventListener('click', ()=>{ lockSize(); });
})();
</script>
</body>
</html>
